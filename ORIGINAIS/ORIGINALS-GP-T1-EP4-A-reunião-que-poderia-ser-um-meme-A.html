<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap');

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    .game-container, .game-stage, .end-screen {
      font-family: "Press Start 2P", system-ui;
      font-weight: 400;
      font-style: normal;
      width: 700px;
      min-height: 500px;
      background-color: #2a2a2a;
      background-position: center bottom;
      background-size: cover;
      display: flex;
      align-items: center;
      justify-content: flex-end;
      flex-direction: column;
      text-align: center;
      margin: 0 auto;
      position: relative;
      box-shadow: 0 5px black, 0 -5px black, 5px 0 black, -5px 0 black, 0 10px #00000038, 5px 5px #00000038, -5px 5px #00000038, inset 0 5px #ffffff36;
    }

    .reaction-bg {
      background-image: url('https://anima-mode.ecossistemaanima.com/wp-content/uploads/2025/08/neutro-1.gif');
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: 0;
    }

    .game-container button, .end-screen button {
      width: 50%;
      padding: 15px 20px;
      font-size: 18px;
      text-transform: uppercase;
      font-weight: 800;
      margin: 0 0 30px 0;
      cursor: pointer;
      color: #fff;
      background-color: #0008ff;
      border: none;
      box-shadow: 0 5px black, 0 -5px black, 5px 0 black, -5px 0 black, 0 10px #00000038, 5px 5px #00000038, -5px 5px #00000038, inset 0 5px #ffffff36;
      transition: transform 0.2s;
    }

    .choice-section button {
      width: 90%;
      padding: 10px;
      font-size: 17px;
      font-weight: 800;
      color: white;
      background-color: #0008ff;
      border: none;
      box-shadow: 0 5px black, 0 -5px black, 5px 0 black, -5px 0 black, 0 10px #00000038, 5px 5px #00000038, -5px 5px #00000038, inset 0 5px #ffffff36;
      cursor: pointer;
      transition: transform 0.2s;
    }

    :root {
      --primary-color: #0008ff;
      --anim-speed-normal: 0.5s;
      --anim-speed-fast: 0.8s;
    }

    .game-container button:hover, .end-screen button:hover, .choice-section button:hover {
      transform: scale(1.05);
      background: var(--primary-color) url(https://i.postimg.cc/8zN3QzKw/pixel-1.png);
      background-size: 180px;
      animation: animatePixel var(--anim-speed-fast) steps(8) forwards;
    }

    @keyframes animatePixel {
      0% { background-position-y: 0; }
      100% { background-position-y: -480px; }
    }

    .choice-section {
      width: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-direction: column;
      text-align: center;
      background-color: white;
      position: absolute;
      bottom: -150px;
      padding: 20px;
      box-shadow: 0 5px black, 0 -5px black, 5px 0 black, -5px 0 black, 0 10px #00000038, 5px 5px #00000038, -5px 5px #00000038, inset 0 5px #ffffff36;
    }

    .choice-section b {
      font-size: 24px;
      margin-bottom: 20px;
      color: #1b1b1b;
    }

    .choice-section ol {
      width: 100%;
      padding: 0 20px;
      list-style: none;
      display: flex;
      flex-direction: column;
      gap: 15px;
    }

    .choice-section li {
      overflow: hidden;
      width: 100%;
      background-color: var(--primary-color);
      box-shadow: 0 5px black, 0 -5px black, 5px 0 black, -5px 0 black, 0 10px #00000038, 5px 5px #00000038, -5px 5px #00000038, inset 0 5px #ffffff36;
      cursor: pointer;
    }

    .choice-section a {
      color: white!important;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 18px;
      line-height: 14px;
      width: 100%;
      height: 100%;
      padding: 10px 5px;
    }

    .choice-section a:hover {
      background: var(--primary-color) url(https://i.postimg.cc/8zN3QzKw/pixel-1.png);
      background-size: 180px;
      animation: animatePixel var(--anim-speed-fast) steps(8) forwards;
    }

    .choice-section li:active {
      transform: scale(1.05) translateY(5px);
      box-shadow: 0 5px black, 0 -5px black, 5px 0 black, -5px 0 black, inset 0 5px #00000038;
      background: var(--primary-color) url(https://i.postimg.cc/8zN3QzKw/pixel-1.png);
      background-size: 180px;
      animation: animatePixel var(--anim-speed-fast) steps(8) forwards;
    }

    .option-group {
      display: flex;
      flex-direction: column;
      gap: 10px;
      justify-content: center;
      width: 100%;
      max-width: 80%;
      color: black;
      background-color: white;
      padding: 15px 10px;
      box-shadow: 0 5px black, 0 -5px black, 5px 0 black, -5px 0 black, 0 10px #00000038, 5px 5px #00000038, -5px 5px #00000038, inset 0 5px #ffffff36;
    }

    .option-group input {
      margin-right: 5px;
    }

    .option-group label {
      width: 100%;
      text-align: start;
      border-bottom: 2px solid black;
      padding: 3px;
      color: black;
    }

    .score-display {
      position: absolute;
      top: 20px;
      right: 20px;
      font-size: 18px;
      color: #00ffcc;
    }

    .speech-bubble {
      color: #0f0f0f;
      text-align: center;
      position: absolute;
      top: 0;
      transform: translateY(-60px);
      padding: 20px;
      background-color: white;
      font-size: 13px;
      margin: 0 10px;
    }

    .speech-bubble::before {
      content: "";
      position: absolute;
      top: -10px;
      left: 40%;
      transform: translateX(150%) translateY(-13px);
      border-left: 50px solid transparent;
      border-right: 0 solid transparent;
      border-bottom: 28px solid #ffffff;
    }

    .end-screen {
      text-align: center;
    }

    #resultStyle {
      width: 95%;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-direction: column;
      text-align: center;
      background-color: white;
      position: absolute;
      bottom: -50px;
      padding: 20px 10px;
      margin: 10px;
      box-shadow: 0 5px black, 0 -5px black, 5px 0 black, -5px 0 black, 0 10px #00000038, 5px 5px #00000038, -5px 5px #00000038, inset 0 5px #ffffff36;
    }

    #result-title {
      font-size: 20px;
      margin-bottom: 20px;
      color: #1b1b1b;
    }

    @media (max-width: 450px) {
      .game-container, .game-stage, .end-screen {
        max-width: 100%;
      }
      .choice-section {
        padding: 20px 0;
        bottom: -250px;
      }
      .choice-section ol {
        flex-direction: column;
      }
      .option-group {
        flex-direction: column;
        max-width: 90%;
        align-items: flex-start;
      }
      .game-container button, .end-screen button {
        width: 80%;
        margin: 0 0 -35px 0;
      }
      .choice-section button {
        width: 80%;
      }
      .option-group label {
        font-size: 11px;
      }
      .speech-bubble {
        top: -40px;
        font-size: 12px;
      }
    }
  </style>
</head>

<body>
  <div class="game-container reaction-bg" id="start-screen">
    <button onclick="initGame()">Iniciar Jogo</button>
  </div>

  <div class="game-stage reaction-bg block-page" id="LP_OPCAO_1" style="display: none;">
    <div class="choice-section">
      <b>Escolha a Pauta</b>
      <ol>
        <li><a alt="Boa, mandou bem!" pontos="50" onclick="pickChoice(this, 'acertou', 'Adorei essa pauta, é relevante!')">Revisar metas da equipe</a></li>
        <li><a alt="Isso é prioridade?"  pontos="-15" onclick="pickChoice(this, 'silencio', 'Falar sobre memes? Isso era prioridade?')">Falar sobre memes</a></li>
        <li><a  alt="Errou (e muito)!" pontos="-30" onclick="pickChoice(this, 'errou', 'Resolver conflitos assim? Isso vai dar errado...')">Resolver conflitos pessoais</a></li>
      </ol>
    </div>
  </div>

  <div class="game-stage reaction-bg" id="LP_OPCAO_2" style="display: none;">
    <div class="choice-section">
      <b>Escolha o Tempo</b>
      <ol>
        <li><a  alt="15 minutos? Pouquíssimo!" pontos="-15" onclick="pickChoice(this, 'errou', '15 minutos? Curto demais, não deu tempo!')">15 minutos</a></li>
        <li><a  alt="Boa, mandou bem! Tempo ótimo" pontos="50" onclick="pickChoice(this, 'acertou', '30 minutos? Tempo ótimo para manter o foco!')">30 minutos</a></li>
        <li><a  alt="Não cara, muito tempo..." pontos="-30" onclick="pickChoice(this, 'silencio', '90 minutos? Já perdi a concentração...')">90 minutos</a></li>
      </ol>
    </div>
  </div>

<!--   <div class="game-stage reaction-bg" style="display: none;">-->
<!--  <div class="choice-section">-->
<!--    <b>Escolha 2 Ferramentas</b>-->
<!--    <ol>-->
<!--      <li><a  alt="Opção menos colaborativa" value="audio" onclick="selectTool(this)">Só áudio</a></li>-->
<!--      <li><a  alt="Boa escolha!" value="chat" onclick="selectTool(this)">Chat</a></li>-->
<!--      <li><a  alt="Ótima escolha!" value="tela" onclick="selectTool(this)">Compartilhar telas</a></li>-->
<!--      <li><a  alt="Excelente escolha!" value="quadro" onclick="selectTool(this)">Quadro branco colaborativo</a></li>-->
<!--      <li><a  alt="Boa escolha!" value="enquetes" onclick="selectTool(this)">Enquetes</a></li>-->
<!--    </ol>-->
<!--    <button onclick="confirmTools()">Pronto!</button>-->
<!--  </div>-->
<!--</div>-->


  <div class="game-stage reaction-bg" id="LP_OPCAO_3" style="display: none;">
    <div class="choice-section">
      <b>Escolha 2 Ferramentas</b>
      <div class="option-group">
        <label><input type="checkbox" onclick="selectTool(this)" value="audio" pontos="-10"> Só áudio</label>
        <label><input type="checkbox" onclick="selectTool(this)" value="chat" pontos="10"> Chat</label>
        <label><input type="checkbox" onclick="selectTool(this)" value="tela" pontos="40"> Compartilhar telas</label>
        <label><input type="checkbox" onclick="selectTool(this)" value="quadro" pontos="50"> Quadro branco colaborativo</label>
        <label><input type="checkbox" onclick="selectTool(this)" value="enquetes" pontos="20"> Enquetes</label>
      </div>
      <button onclick="confirmTools()">Pronto!</button>
    </div>
  </div>

  <div class="end-screen" id="result-screen" style="display: none;">
    <div id="resultStyle">
      <b id="result-title"></b>
    </div>
  </div>

  <script>
    let gameScore = 0;
    let chosenTools = [];
    let startTimestamp = null;
    let playCount = parseInt(localStorage.getItem('attempts')) || 0;
    let gameHistory = JSON.parse(localStorage.getItem('history')) || [];

    function initGame() {
      // if (localStorage.getItem('hasPlayed')) {
      //   alert("Você já teve sua chance de fazer a reunião perfeita! - Dex");
      //   return;
      // }
      startTimestamp = new Date();
      playCount++;
      gameScore = 0;
      chosenTools = [];
      document.getElementById('start-screen').style.display = 'none';
      document.getElementById('LP_OPCAO_1').style.display = 'block';

      if (localStorage.getItem('hasPlayed')) {
        document.querySelectorAll('a[pontos], input[pontos]').forEach(el => el.removeAttribute('pontos'));
      }
    }

    function pickChoice(element, reaction, message) {
      const points = parseInt(element.getAttribute('pontos') || 0);
      gameScore += points;
      updateReaction(reaction, message);
      const currentStage = element.closest('.game-stage').id;
      document.querySelectorAll(`#${currentStage} a`).forEach(link => {
        link.style.pointerEvents = 'none';
        link.style.opacity = '0.6';
      });
      setTimeout(() => {
        document.getElementById(currentStage).style.display = 'none';
        const nextStage = parseInt(currentStage.split('_')[2]) + 1;
        if (nextStage <= 3) {
          document.getElementById(`LP_OPCAO_${nextStage}`).style.display = 'block';
        }
      }, 3500);
    }

function selectTool(element) {
  const value = element.getAttribute('value');

  if (chosenTools.some(tool => tool.value === value)) {
    // Remove a seleção se clicar novamente
    chosenTools = chosenTools.filter(tool => tool.value !== value);
    element.style.opacity = '1';
  } else if (chosenTools.length >= 2) {
    alert('Selecione exatamente duas ferramentas!');
    return;
  } else {
    // Adiciona a nova seleção
    chosenTools.push({ value });
    element.style.opacity = '0.6'; // Visual de seleção
  }

  // Se exatamente duas ferramentas forem selecionadas, atribui pontos e adiciona o id
  if (chosenTools.length === 2) {
    const pointsMap = {
      'audio': -10,
      'chat': 10,
      'tela': 40,
      'quadro': 50,
      'enquetes': 20
    };

    // Atribui pontos dinamicamente e adiciona o atributo pontos aos links
    chosenTools = chosenTools.map(tool => {
      const link = document.querySelector(`.game-stage a[value="${tool.value}"]`);
      const points = pointsMap[tool.value] || 0;
      link.setAttribute('pontos', points); // Adiciona o atributo pontos dinamicamente
      return { ...tool, points };
    });

    // Adiciona o id="LP_OPCAO_3" à div da seção
    const section = document.querySelector('.game-stage:not([id])[style*="display: block"]');
    if (section) {
      section.setAttribute('id', 'LP_OPCAO_3');
    }
  }
}

function confirmTools() {
  if (chosenTools.length !== 2) {
    alert('Selecione exatamente duas ferramentas!');
    return;
  }

  const points = chosenTools.reduce((sum, tool) => sum + tool.points, 0);
  gameScore += points;

  const message = points >= 60 
    ? 'Essas ferramentas nos ajudam a colaborar de verdade!' 
    : 'Essas ferramentas são meio genéricas...';
  
  updateReaction(points >= 60 ? 'acertou' : 'silencio', message);
  
  const confirmBtn = document.querySelector('.game-stage button');
  confirmBtn.setAttribute('alt', message);
  confirmBtn.style.pointerEvents = 'none';
  confirmBtn.style.opacity = '0.6';
  
  // Desativa cliques nos links após confirmação
  document.querySelectorAll('.game-stage a').forEach(link => {
    link.style.pointerEvents = 'none';
    link.style.opacity = '0.6';
  });
  
  setTimeout(showOutcome, 5000);
}

    function selectTool(checkbox) {
  if (checkbox.checked && chosenTools.length >= 2) {
    checkbox.checked = false;
    alert('Selecione exatamente duas ferramentas!');
    return;
  }

  chosenTools = Array.from(document.querySelectorAll('input[type="checkbox"]:checked')).map(cb => {
    const pontosAttr = cb.getAttribute('pontos');
    const points = isNaN(parseInt(pontosAttr)) ? 0 : parseInt(pontosAttr); // Garante que pontos inválidos sejam 0
    // console.log(`Checkbox ${cb.value}: pontos = ${points}`); 
    return {
      value: cb.value,
      points: points
    };
  });
}

function confirmTools() {
  if (chosenTools.length !== 2) {
    alert('Selecione exatamente duas ferramentas!');
    return;
  }

  const points = chosenTools.reduce((sum, tool) => sum + tool.points, 0);
//   console.log('Pontos somados:', points, 'gameScore antes:', gameScore);
  gameScore += points; // Atualiza gameScore
//   console.log('gameScore depois:', gameScore); 

  const message = points >= 60 
    ? 'Essas ferramentas nos ajudam a colaborar de verdade!' 
    : 'Essas ferramentas são meio genéricas...';
  
  updateReaction(points >= 60 ? 'acertou' : 'silencio', message);
  
  const confirmBtn = document.querySelector('#LP_OPCAO_3 button');
  confirmBtn.setAttribute('alt', message);
  confirmBtn.style.pointerEvents = 'none';
  confirmBtn.style.opacity = '0.6';
  
  setTimeout(showOutcome, 5000);
}

    // function selectTool(checkbox) {
    //   if (checkbox.checked && chosenTools.length >= 2) {
    //     checkbox.checked = false;
    //     alert('Selecione exatamente duas ferramentas!');
    //     return;
    //   }
    //   chosenTools = Array.from(document.querySelectorAll('input[type="checkbox"]:checked')).map(cb => ({
    //     value: cb.value,
    //     points: parseInt(cb.getAttribute('pontos') || 0)
    //   }));
    // }

    // function confirmTools() {
    //   if (chosenTools.length !== 2) {
    //     alert('Selecione exatamente duas ferramentas!');
    //     return;
    //   }
    //   const points = chosenTools.reduce((sum, tool) => sum + (tool.points || 0), 0);
    //   gameScore += points;
      
    //   updateReaction(points >= 60 ? 'acertou' : 'silencio', points >= 60 ? 'Essas ferramentas nos ajudam a colaborar de verdade!' : 'Essas ferramentas são meio genéricas...');
    //   const confirmBtn = document.querySelector('#LP_OPCAO_3 button');
    //   confirmBtn.setAttribute('alt', 'Mensagem de pontuação aqui');
    //   confirmBtn.style.pointerEvents = 'none';
    //   confirmBtn.style.opacity = '0.6';
    //   setTimeout(showOutcome, 5000);
    // }

    function updateReaction(reaction, message) {
      const reactionElements = document.querySelectorAll('.reaction-bg');
      reactionElements.forEach(el => el.style.backgroundImage = `url('https://anima-mode.ecossistemaanima.com/wp-content/uploads/2025/08/${reaction}.gif')`);
      const speech = document.createElement('div');
      speech.className = 'speech-bubble';
      speech.textContent = message;
      document.querySelector('.game-stage:not([style*="display: none"]) .choice-section').appendChild(speech);
      setTimeout(() => {
        reactionElements.forEach(el => el.style.backgroundImage = `url('https://anima-mode.ecossistemaanima.com/wp-content/uploads/2025/08/neutro.gif')`);
        speech.remove();
      }, 3500);
    }

    function showOutcome() {
      const endTimestamp = new Date();
      const duration = Math.round((endTimestamp - startTimestamp) / 1000);
      const isSuccessful = gameScore >= 80;
      document.querySelectorAll('.game-stage').forEach(el => el.style.display = 'none');
      const resultScreen = document.getElementById('result-screen');
      resultScreen.style.display = 'block';
      resultScreen.style.backgroundImage = `url('https://anima-mode.ecossistemaanima.com/wp-content/uploads/2025/08/${isSuccessful ? 'boa_reuniao' : 'ma_reuniao'}.gif')`;
      document.getElementById('result-title').textContent = isSuccessful ? 'Reunião Produtiva! Parabéns! Você liderou com clareza e foco.' : 'Ops! Sua reunião saiu do controle, e o BARKLEY DANÇOU!';

      gameHistory.push({ attempt: playCount, score: gameScore, result: isSuccessful ? 'Produtiva' : 'Caótica', duration });
      localStorage.setItem('attempts', playCount);
      localStorage.setItem('history', JSON.stringify(gameHistory));
      localStorage.setItem('hasPlayed', 'true');
    }
  </script>
</body>
</html>